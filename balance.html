<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>余额记录</title>
    <style>
        /* 与首页保持一致的容器尺寸 */
        @media (min-width: 0px) and (max-width:350px) {
            .div1 { width: 350px; height: 85px; border-radius: 8px; background-color: #cfe6f7; }
        }
        @media (min-width: 350px) and (max-width:500px) {
            .div1 { width: auto; height: 75px; border-radius: 8px; background-color: #cfe6f7; }
        }
        @media (min-width: 500px) {
            .div1 { width: 360px; height: 85px; border-radius: 8px; background-color: #cfe6f7; }
        }

        .nav-bar { display: flex; justify-content: center; margin-top: 8px; }
        .nav-btn {
            background: linear-gradient(135deg, #f7f9ff 0%, #f0f4ff 100%);
            color: #2f4fa7;
            border: 1px solid #d9e3ff;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(47, 79, 167, 0.15);
            transition: all 0.2s ease;
        }
        .nav-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 10px rgba(47, 79, 167, 0.22); }
        .page-header { display:flex; align-items:center; justify-content:space-between; height:44px; padding:0 10px; }
        .nav-right { display:flex; align-items:center; gap:8px; }
        .page-title { font-size:20px; color:#0b5ea8; background-color:#b3d2ee; border-radius:8px; padding:4px 14px; border:1px solid #5ba46b; }

        .balance-card { background:#f8fffe; border-radius:12px; padding:16px; box-shadow:0 4px 20px rgba(78,115,223,0.1); border:1px solid rgba(78,115,223,0.15); margin:10px; }
        .date-banner { font-weight:600; color:#2c3e50; margin-bottom:10px; background:#eaf4ff; border:1px solid #d6e7fb; border-radius:8px; padding:8px 12px; display:flex; justify-content:space-between; align-items:center; }
        .date-lines { display:flex; flex-direction:column; gap:2px; }
        .reset-btn { background:#ffffff; color:#2c3e50; border:1px solid #e0e9f3; padding:6px 10px; border-radius:6px; font-size:14px; cursor:pointer; }
        .reset-btn:hover { background:#f5f9ff; }

        .grid { display:grid; grid-template-columns: 1fr; gap:12px; }
        .section { background:white; border-radius:8px; padding:10px; box-shadow:0 1px 3px rgba(0,0,0,0.08); }
        .section-title { font-weight:700; color:#2c3e50; margin-bottom:8px; }
        .inline-row { display:flex; align-items:center; gap:6px; flex-wrap: wrap; }
        .money-input { flex:1 1 140px; min-width:0; border:1px solid #e0e9f3; border-radius:6px; padding:6px 8px; font-size:14px; box-sizing:border-box; }
        .note-input { flex:2 1 200px; min-width:0; border:1px solid #e0e9f3; border-radius:6px; padding:6px 8px; font-size:14px; box-sizing:border-box; }
        .record-btn { flex:0 0 auto; white-space:nowrap; background:#ffffff; color:#2c3e50; border:1px solid #e0e9f3; padding:6px 10px; border-radius:6px; font-size:14px; cursor:pointer; }
        .record-btn:hover { background:#f5f9ff; }

        .list { margin-top:8px; border-top:1px dashed #e0e9f3; padding-top:8px; }
        .item { padding:6px 8px; background:#f9fbff; border:1px solid #e6eef8; border-radius:6px; margin-bottom:6px; }
        .meta { font-size:12px; color:#6c757d; }
        .total-line { font-weight:600; color:#2c3e50; margin-bottom:6px; }
    </style>
</head>
<body>
<div class="div1">
    <div style="width: auto;border: 1px solid green;text-align:center;border-radius: 10px;">
        <div class="page-header">
            <div class="page-title">余额记录</div>
            <div class="nav-right">
                <button class="nav-btn" onclick="location.replace('index.html')">首页</button>
            </div>
        </div>

        <div class="balance-card">
            <div class="date-banner">
                <div class="date-lines">
                    <div id="todayText">今日：-</div>
                    <div id="grandText">总计：0.00 元</div>
                </div>
                <button class="reset-btn" id="clearToday">清空当日记录</button>
            </div>

            <div class="grid">
                <div class="section" id="sec-bank">
                    <div class="section-title">银行卡</div>
                    <div class="inline-row">
                        <input class="money-input" id="amount-bank" type="number" step="0.01" placeholder="金额（元）">
                        <button class="record-btn" onclick="addRecord('银行卡')">添加记录</button>
                    </div>
                    <div class="list" id="list-bank"></div>
                </div>

                <div class="section" id="sec-alipay">
                    <div class="section-title">支付宝</div>
                    <div class="inline-row">
                        <input class="money-input" id="amount-alipay" type="number" step="0.01" placeholder="金额（元）">
                        <button class="record-btn" onclick="addRecord('支付宝')">添加记录</button>
                    </div>
                    <div class="list" id="list-alipay"></div>
                </div>

                <div class="section" id="sec-wechat">
                    <div class="section-title">微信</div>
                    <div class="inline-row">
                        <input class="money-input" id="amount-wechat" type="number" step="0.01" placeholder="金额（元）">
                        <button class="record-btn" onclick="addRecord('微信')">添加记录</button>
                    </div>
                    <div class="list" id="list-wechat"></div>
                </div>

                <div class="section" id="sec-other">
                    <div class="section-title">其他</div>
                    <div class="inline-row">
                        <input class="money-input" id="amount-other" type="number" step="0.01" placeholder="金额（元）">
                        <input class="note-input" id="input-other" type="text" placeholder="备注（仅其他项需要说明，选填）">
                        <button class="record-btn" onclick="addRecord('其他')">添加记录</button>
                    </div>
                    <div class="total-line" id="total-other"></div>
                    <div class="list" id="list-other"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function getTodayInfo() {
        const now = new Date();
        const optsDate = { timeZone: 'Asia/Shanghai' };
        const dateCN = now.toLocaleDateString('zh-CN', optsDate); // yyyy/M/d
        const [y, m, d] = dateCN.split('/').map(Number);
        const pad = n => (n < 10 ? '0' + n : '' + n);
        const dateStr = `${y}-${pad(m)}-${pad(d)}`;
        const timeStr = now.toLocaleTimeString('zh-CN', { hour12: false, timeZone: 'Asia/Shanghai' }).slice(0,5);
        return { y, m, d, dateStr, timeStr };
    }

    function readStore() {
        try { return JSON.parse(localStorage.getItem('balanceRecords') || '{}'); }
        catch(e) { return {}; }
    }
    function writeStore(data) {
        localStorage.setItem('balanceRecords', JSON.stringify(data));
    }

    const cats = ['银行卡','支付宝','微信','其他'];

    function ensureToday(data, today) {
        if (!data[today]) data[today] = {};
        cats.forEach(c => { if (!data[today][c]) data[today][c] = []; });
        return data;
    }

    function render(today) {
        const data = readStore();
        ensureToday(data, today);
        const mapId = {
            '银行卡': 'list-bank',
            '支付宝': 'list-alipay',
            '微信': 'list-wechat',
            '其他': 'list-other'
        };
        let grand = 0;
        cats.forEach(c => {
            const container = document.getElementById(mapId[c]);
            container.innerHTML = '';
            const items = data[today][c];
            let catSum = 0;
            items.forEach(item => { if (item.amount != null) catSum += Number(item.amount) || 0; });
            grand += catSum;
            if (c === '其他') {
                const totalEl = document.getElementById('total-other');
                if (totalEl) totalEl.textContent = `合计：${catSum.toFixed(2)} 元`;
            }
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item';
                const meta = document.createElement('div');
                meta.className = 'meta';
                meta.textContent = `${c} · ${item.time}`;
                const text = document.createElement('div');
                text.textContent = item.amount != null ? `金额：${item.amount} 元${item.text ? ' ｜ ' + item.text : ''}` : item.text;
                div.appendChild(meta);
                div.appendChild(text);
                container.appendChild(div);
            });
        });
        document.getElementById('todayText').textContent = `今日：${today}`;
        const grandEl = document.getElementById('grandText');
        if (grandEl) grandEl.textContent = `总计：${grand.toFixed(2)} 元`;
    }

    function addRecord(cat) {
        const amountIds = {
            '银行卡': 'amount-bank',
            '支付宝': 'amount-alipay',
            '微信': 'amount-wechat',
            '其他': 'amount-other'
        };
        let note = '';
        if (cat === '其他') {
            const ta = document.getElementById('input-other');
            note = (ta.value || '').trim();
        }
        const amountRaw = document.getElementById(amountIds[cat]).value;
        const hasAmount = amountRaw !== '' && !isNaN(parseFloat(amountRaw));
        const amount = hasAmount ? parseFloat(amountRaw) : null;
        // 只有“其他”可以只填说明；其他分类至少要有金额
        if (!hasAmount && cat !== '其他') return;
        if (!note && !hasAmount) return;
        const info = getTodayInfo();
        const data = ensureToday(readStore(), info.dateStr);
        data[info.dateStr][cat].push({ text: note, amount: amount, time: info.timeStr });
        writeStore(data);
        if (cat === '其他') document.getElementById('input-other').value = '';
        document.getElementById(amountIds[cat]).value = '';
        render(info.dateStr);
    }

    function clearToday() {
        const info = getTodayInfo();
        const data = readStore();
        data[info.dateStr] = { '银行卡': [], '支付宝': [], '微信': [], '其他': [] };
        writeStore(data);
        render(info.dateStr);
    }

    window.addEventListener('load', function() {
        const info = getTodayInfo();
        render(info.dateStr);
        document.getElementById('clearToday').addEventListener('click', clearToday);
    });
</script>
<script>
// 注册 Service Worker，屏蔽 miao.baidu.com 的网络请求
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').catch(function(){});
}
</script>
</body>
</html>
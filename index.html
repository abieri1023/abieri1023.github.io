<!DOCTYPE html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>æ’ç­å°ç¨‹åº</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
    <link rel="shortcut icon" href="home.ico">
    <style>
        @media (min-width: 0px) and (max-width:350px) {
            .div1 {
                width: 350px;
                height: 85px;
                border-radius: 8px;
                background-color: #cfe6f7;
            }
        }

        @media (min-width: 350px) and (max-width:500px) {
            .div1 {
                width: auto;
                height: 75px;
                border-radius: 8px;
                background-color: #cfe6f7;
            }
        }

        @media (min-width: 500px) {
            .div1 {
                width: 360px;
                height: 85px;
                border-radius: 8px;
                background-color: #cfe6f7;
            }
        }

        /* æ–°å¢æ ·å¼ï¼ˆé€‚åº¦ç¼©å°å­—ä½“ï¼‰ */
        #recentShifts .shift-date {
            font-size: 14px;
            color: #666;
            margin-bottom: 4px;
        }

        #recentShifts .shift-status {
            font-size: 14px;
            font-weight: 600;
        }

        .shift-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .date-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .relative-day {
            color: #666;
            font-size: 14px;
            min-width: 42px;
            font-weight: 600;
        }

        .week-day {
            color: #999;
            font-size: 14px;
            margin-right: 6px;
        }

        .shift-date {
            color: #444;
            font-size: 14px;
            font-weight: 500;
        }

        .shift-status {
            font-size: 14px;
            font-weight: 600;
            min-width: 80px;
            text-align: right;
        }
    </style>
    <style>
        .calculator-card {
            background: linear-gradient(135deg, #f8fffe 0%, #f0f9ff 100%);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(78, 115, 223, 0.1);
            border: 1px solid rgba(78, 115, 223, 0.15);
        }

        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            margin-bottom: 20px;
        }

        .date-input {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid #e0e9f3;
            border-radius: 8px;
            font-size: 16px;
            color: #2c3e50;
            background: white;
            min-width: 200px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(78, 115, 223, 0.05);
        }

        .date-input:focus {
            outline: none;
            border-color: #4e72df;
            box-shadow: 0 0 0 3px rgba(78, 115, 223, 0.1);
        }

        .input-label {
            font-size: 18px;
            color: #4e72df;
            font-weight: 600;
            margin-left: 8px;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #4e72df 0%, #849ced 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 12px rgba(78, 115, 223, 0.25);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(78, 115, 223, 0.35);
        }

        #result1 {
            font-size: 24px;
            color: #2c3e50;
            font-weight: 700;
            margin: 16px 0 6px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
        }

        #result2 {
            font-size: 16px;
            color: #6c757d;
            font-weight: 500;
            margin-top: 10px;
        }
    </style>
    <style>
        .nav-bar { display: flex; justify-content: center; margin-top: 8px; }
        .nav-btn {
            background: linear-gradient(135deg, #f7f9ff 0%, #f0f4ff 100%);
            color: #2f4fa7;
            border: 1px solid #d9e3ff;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(47, 79, 167, 0.15);
            transition: all 0.2s ease;
        }
        .nav-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 10px rgba(47, 79, 167, 0.22); }
        .page-header { display:flex; align-items:center; justify-content:space-between; height:44px; padding:0 10px; }
        .nav-right { display:flex; align-items:center; gap:8px; }
        .page-title { font-size:20px; color:#0b5ea8; background-color:#b3d2ee; border-radius:8px; padding:4px 14px; border:1px solid #5ba46b; }
        .month-calendar { background:#f8fffe; border-radius:12px; padding:16px; box-shadow:0 4px 20px rgba(78,115,223,0.1); border:1px solid rgba(78,115,223,0.15); margin:10px 10px 20px; }
        .calendar-header { display:flex; justify-content:space-between; align-items:center; font-weight:600; color:#2c3e50; margin-bottom:10px; }
        .month-btn { background:linear-gradient(135deg,#f3f6ff 0%,#eef3ff 100%); color:#2f4fa7; border:1px solid #d9e3ff; padding:8px 14px; border-radius:8px; font-size:16px; font-weight:600; cursor:pointer; box-shadow:0 2px 6px rgba(47,79,167,0.15); }
.month-btn:hover { transform: translateY(-1px); box-shadow:0 4px 10px rgba(47,79,167,0.22); }
        .weekday-header { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; margin: 6px 0; font-size:12px; color:#6c757d; }
        .weekday-cell { text-align:center; font-weight:600; }
        .calendar-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; }
        .calendar-cell { background:white; border-radius:8px; padding:8px; box-shadow:0 1px 3px rgba(0,0,0,0.08); text-align:center; }
        .cell-day { font-weight:700; color:#2c3e50; }
        .cell-status { font-size:12px; margin-top:4px; display:inline-block; padding:2px 6px; border-radius:6px; font-weight:600; }
        .status-day { background:#bbdefb; color:#0d47a1; }
        .status-night { background:#ffe0b2; color:#e65100; }
        .status-rest { background:#c8e6c9; color:#1b5e20; }
        .is-today { border:1px solid #4ba2f9; background:linear-gradient(90deg,#e3f2fd,#f0f8ff); }
    </style>
</head>

<body>

    <div class="div1">
        <div style="width: auto;border: 2px solid green;text-align:center;border-radius: 10px;">
            <div class="page-header">
                 <div class="page-title">æ’ç­å°ç¨‹åº</div>
                 <div class="nav-right">
                     <button class="nav-btn" onclick="location.href='address.html'">åœ°å€é¡µ</button>
                     <button class="nav-btn" onclick="location.href='balance.html'">ä½™é¢è®°å½•</button>
                 </div>
             </div>

            <br>

             <!-- ä¿®æ”¹åçš„å‚ç›´æ’ç­å±•ç¤ºå®¹å™¨ -->
            <div id="recentShifts" style="margin-bottom: 20px; padding: 10px; background: #e8f4ff; border-radius: 8px;">
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <!-- é‡å¤4ä¸ªæ—¥æœŸé¡¹ -->
                    <div class="shift-item">
                        <div class="date-info">
                            <span class="relative-day"></span>
                            <div>
                                <span class="week-day"></span>
                                <span class="shift-date"></span>
                            </div>
                        </div>
                        <div class="shift-status"></div>
                    </div>
                    <div class="shift-item">
                        <div class="date-info">
                            <span class="relative-day"></span>
                            <div>
                                <span class="week-day"></span>
                                <span class="shift-date"></span>
                            </div>
                        </div>
                        <div class="shift-status"></div>
                    </div>
                    <div class="shift-item">
                        <div class="date-info">
                            <span class="relative-day"></span>
                            <div>
                                <span class="week-day"></span>
                                <span class="shift-date"></span>
                            </div>
                        </div>
                        <div class="shift-status"></div>
                    </div>
                    <div class="shift-item">
                        <div class="date-info">
                            <span class="relative-day"></span>
                            <div>
                                <span class="week-day"></span>
                                <span class="shift-date"></span>
                            </div>
                        </div>
                        <div class="shift-status"></div>
                    </div>
                    <!-- å¤åˆ¶3ä¸ªç›¸åŒç»“æ„çš„shift-item -->
                </div>
            </div>

            <div class="month-calendar">
                 <div class="calendar-header">
                     <button class="month-btn" id="prevMonthBtn">â† ä¸Šä¸ªæœˆ</button>
                     <div id="calendarHeader"></div>
                     <button class="month-btn" id="nextMonthBtn">ä¸‹ä¸ªæœˆ â†’</button>
                 </div>
                 <div class="weekday-header" id="weekdayHeader"></div>
                 <div class="calendar-grid" id="monthCalendarGrid"></div>
             </div>

            <div style="background-color: #f4fff5;border-radius: 8px;">

                <div class="calculator-card">
                    <div class="input-group">
                        <input type="text" class="date-input" id="endDate" placeholder="ç‚¹å‡»é€‰æ‹©æ—¥æœŸ" readonly onclick="openDatePicker()">
                        <div class="input-hint">æç¤ºï¼šç‚¹å‡»æ—¥æœŸå¯ä»¥é€‰æ‹©æ—¥æœŸ</div>
                    </div>

                    <button class="calculate-btn" onclick="calculateDateDifference()">
                        è®¡ ç®—
                    </button>

                    <div id="result1"></div>
                    <div id="result2"></div>
                </div>

                <div id="myDiv" hidden>
                    <div>
                        <hr>
                        <a style="color: red;font-size: 20px;font-weight:bolder;">ç‚¹å‡»ä¸‹é¢æŒ‰é’®å¯ä»¥ç»™å¨ƒæ‰“é’±ï¼</a>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <p></p>
                    </div>

                    <a style="background-color: #6ad16a;padding: 10px;font-size: 20px;
            color: white;border-radius: 8px;" href="weixin://">æ‰“å¼€å¾®ä¿¡</a>
                    <a style="background-color: #6fb1f3;padding: 10px;font-size: 20px;
            color: white;border-radius: 8px;" href="alipays://">æ‰“å¼€æ”¯ä»˜å®</a>
                    <div style="padding-top: 40px;"></div>
                </div>
            </div>
            <div style="width: auto;text-align:center;border-radius: 10px;margin-top: 5px;">
                <button style="height: 45px;" onclick="toggleVisibility1()">è§‰å¾—å¥½ç”¨å¯ä»¥ç‚¹è¿™é‡Œï¼æœ‰å¥½ä¸œè¥¿å“Ÿï¼</button>
                <button style="height: 45px;" onclick="toggleVisibility2()">ä¸å¥½ç”¨ï¼</button>

            </div>


<script>
// æ³¨å†Œ Service Workerï¼Œå±è”½ miao.baidu.com çš„ç½‘ç»œè¯·æ±‚
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').catch(function(){});
}
</script>
</body>
<style>
    input[type="date"] {
        outline: none;
        appearance: none;
        -moz-appearance: none;
        -webkit-appearance: none;
    }

    .input-group { margin: 8px 0 10px; }
    .input-hint { margin-top: 4px; font-size: 12px; color: #6c757d; }
    .date-input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #e0e9f3;
        border-radius: 8px;
        background: #ffffff;
        font-size: 16px;
        color: #2c3e50;
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .date-input::-webkit-calendar-picker-indicator {
        cursor: pointer;
        padding: 4px;
        border-radius: 6px;
        filter: invert(36%) sepia(12%) saturate(1091%) hue-rotate(178deg) brightness(95%) contrast(91%);
    }

    a {
        text-decoration: none;
    }

    button {
        background-color: #75b6f6;
        color: white;
        height: 40px;
        border: 0;
        font-size: 16px;
        border-radius: 8px;
    }

    button:hover {
        background-color: #4ba2f9
    }

    /* å¢å¼ºæŠ–åŠ¨åŠ¨ç”» */
    @keyframes shake {
        0%, 100% { transform: translate(0, 0) rotate(0deg); }
        10% { transform: translate(-10px, -10px) rotate(-2deg); }
        20% { transform: translate(10px, 10px) rotate(2deg); }
        30% { transform: translate(-10px, 10px) rotate(-2deg); }
        40% { transform: translate(10px, -10px) rotate(2deg); }
        50% { transform: translate(-8px, -8px) rotate(-1deg); }
        60% { transform: translate(8px, 8px) rotate(1deg); }
        70% { transform: translate(-6px, 6px) rotate(-1deg); }
        80% { transform: translate(6px, -6px) rotate(1deg); }
        90% { transform: translate(-4px, -4px) rotate(-0.5deg); }
    }

    /* æ·¡å…¥æ·¡å‡ºåŠ¨ç”» */
    @keyframes fadeInOut {
        0% {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
        }
        20% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1);
        }
        80% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }
        100% {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
        }
    }
</style>
<script>
    // æ–°å¢å‡½æ•°ï¼šè·å–æŒ‡å®šæ—¥æœŸçš„ç­æ¬¡
    function getShiftStatus(targetDate) {
        var startDate = new Date("2023-07-02");
        var millisecondsPerDay = 24 * 60 * 60 * 1000;
        var daysDifference = Math.round((targetDate - startDate) / millisecondsPerDay);

        var dayId = daysDifference % 5;
        switch (dayId) {
            case 0: return "ç¬¬1ä¸ªå¤œç­";
            case 1: return "ç¬¬2ä¸ªå¤œç­";
            case 2: return "ç¬¬1ä¸ªç™½ç­";
            case 3: return "ç¬¬2ä¸ªç™½ç­";
            case 4: return "ä¼‘æ¯å¤©";
            default: return "å¼‚å¸¸";
        }
    }

    // ä¿®æ”¹åçš„ç”Ÿæˆå‡½æ•°
    function generateRecentShifts() {
    const shiftItems = document.querySelectorAll('.shift-item');
    const now = new Date();
    
    // è·å–ä¸œå…«åŒºåŸºå‡†æ—¶é—´
    const east8DateString = now.toLocaleDateString('zh-CN', { timeZone: 'Asia/Shanghai' });
    const [year, month, day] = east8DateString.split('/').map(Number);
    const todayUTC8 = new Date(Date.UTC(year, month - 1, day));
    
    const dayLabels = ['æ˜¨å¤©', 'ä»Šå¤©', 'æ˜å¤©', 'åå¤©'];

    shiftItems.forEach((item, index) => {
        const date = new Date(todayUTC8);
        const dayOffset = index - 1;
        date.setUTCDate(date.getUTCDate() + dayOffset);

        // è®¾ç½®ç›¸å¯¹æ—¥æœŸæ ‡ç­¾
        const relativeDay = item.querySelector('.relative-day');
        relativeDay.textContent = dayLabels[index];

        // è®¾ç½®ä¸œå…«åŒºçš„æ˜ŸæœŸå’Œæ—¥æœŸ
        const weekDay = item.querySelector('.week-day');
        weekDay.textContent = date.toLocaleDateString('zh-CN', { 
            weekday: 'short', 
            timeZone: 'Asia/Shanghai'  // ä¸œå…«åŒºæ—¶åŒº[7](@ref)
        });

        const dateElement = item.querySelector('.shift-date');
        dateElement.textContent = date.toLocaleDateString('zh-CN', { 
            month: '2-digit', 
            day: '2-digit', 
            timeZone: 'Asia/Shanghai'  // ä¸œå…«åŒºæ—¶åŒº[7](@ref)
        });

        // è®¡ç®—ç­æ¬¡çŠ¶æ€ï¼ˆä¸ä¸‹æ–¹è®¡ç®—é€»è¾‘å®Œå…¨ä¸€è‡´ï¼‰
        const statusElement = item.querySelector('.shift-status');
        const status = getShiftStatus(date);
        statusElement.textContent = status;
        statusElement.style.color = status === 'ä¼‘æ¯å¤©' ? '#4CAF50' : '#FF5722';

        // é«˜äº®"ä»Šå¤©"ï¼ˆUTCåŸºå‡†çš„ä»Šå¤©ï¼‰
        if (index === 1) {
            item.style.background = "linear-gradient(90deg, #e3f2fd, #f0f8ff)";
            item.style.border = "1px solid #4ba2f9";
            relativeDay.style.color = "#2196F3";
        }
    });
}

    function normalizeShift(status) {
        if (status.indexOf('ç™½ç­') !== -1) return 'ç™½';
        if (status.indexOf('å¤œç­') !== -1) return 'å¤œ';
        if (status.indexOf('ä¼‘æ¯') !== -1) return 'ä¼‘';
        return 'å¼‚å¸¸';
    }

    let calendarYear, calendarMonth; // month: 1-12
    let todayInfo = (function() {
        const now = new Date();
        const east8String = now.toLocaleDateString('zh-CN', { timeZone: 'Asia/Shanghai' });
        const [y, m, d] = east8String.split('/').map(Number);
        return { y, m, d };
    })();

    function renderCalendarHeader() {
        const header = document.getElementById('calendarHeader');
        header.textContent = `${calendarYear}å¹´${('0' + calendarMonth).slice(-2)}æœˆ`;
    }

    function generateMonthlyCalendar() {
        const y = calendarYear;
        const m = calendarMonth - 1; // Dateä½¿ç”¨0-11
        const firstDay = new Date(y, m, 1);
        const daysInMonth = new Date(y, m + 1, 0).getDate();
        const offset = firstDay.getDay(); // 0-6 (å‘¨æ—¥ä¸º0)

        renderCalendarHeader();

        const grid = document.getElementById('monthCalendarGrid');
        grid.innerHTML = '';

        for (let i = 0; i < offset; i++) {
            const empty = document.createElement('div');
            empty.className = 'calendar-cell';
            empty.style.visibility = 'hidden';
            grid.appendChild(empty);
        }

        for (let dayNum = 1; dayNum <= daysInMonth; dayNum++) {
            const date = new Date(y, m, dayNum);
            const statusFull = getShiftStatus(date);
            const statusShort = normalizeShift(statusFull);
            const cell = document.createElement('div');
            cell.className = 'calendar-cell';

            // é«˜äº®ä»Šå¤©ï¼ˆä»…å½“æ¸²æŸ“çš„æœˆä»½ä¸ä»Šå¤©ä¸€è‡´æ—¶ï¼‰
            if (todayInfo.y === y && todayInfo.m === (m + 1) && todayInfo.d === dayNum) {
                cell.classList.add('is-today');
            }

            const dayEl = document.createElement('div');
            dayEl.className = 'cell-day';
            dayEl.textContent = dayNum;

            const statusEl = document.createElement('div');
            statusEl.className = 'cell-status ' + (statusShort === 'ç™½' ? 'status-day' : statusShort === 'å¤œ' ? 'status-night' : statusShort === 'ä¼‘' ? 'status-rest' : '');
            statusEl.textContent = statusShort;

            cell.appendChild(dayEl);
            cell.appendChild(statusEl);
            grid.appendChild(cell);
        }
    }

    function prevMonth() {
        if (calendarMonth === 1) { calendarMonth = 12; calendarYear--; }
        else { calendarMonth--; }
        generateMonthlyCalendar();
    }

    function nextMonth() {
        if (calendarMonth === 12) { calendarMonth = 1; calendarYear++; }
        else { calendarMonth++; }
        generateMonthlyCalendar();
    }

    function renderWeekdays() {
        const names = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
        const header = document.getElementById('weekdayHeader');
        header.innerHTML = '';
        names.forEach(n => {
            const span = document.createElement('div');
            span.className = 'weekday-cell';
            span.textContent = `å‘¨${n}`;
            header.appendChild(span);
        });
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ç”Ÿæˆæ’ç­ä¿¡æ¯
    window.addEventListener('load', function () {
        // è¿‘æœŸç­æ¬¡
        generateRecentShifts();
        // åˆå§‹åŒ–æ—¥å†å¹´æœˆä¸ºä¸œå…«åŒºå½“å‰
        calendarYear = todayInfo.y; calendarMonth = todayInfo.m;
        // æ¸²æŸ“å‘¨æ ‡é¢˜
        renderWeekdays();
        // æ¸²æŸ“å½“æœˆ
        generateMonthlyCalendar();
        // é¡µé¢ç»“æ„ï¼šæŠŠâ€œæ—¥å†æ¨¡å—â€æ”¾åœ¨â€œæ˜¨ä»Šæ˜åæ¨¡å—â€ä¹‹å‰
        (function reorderModules(){
            const recent = document.getElementById('recentShifts');
            const calendar = document.querySelector('.month-calendar');
            if (recent && calendar && calendar.parentNode) {
                calendar.parentNode.insertBefore(calendar, recent);
            }
        })();
        // ç»‘å®šåˆ‡æ¢æŒ‰é’®
        document.getElementById('prevMonthBtn').addEventListener('click', prevMonth);
        document.getElementById('nextMonthBtn').addEventListener('click', nextMonth);
        // ä¿æŒåŸæœ‰çš„å½“å‰æ—¥æœŸè®¾ç½®
        endDateInput.value = getCurrentTime().slice(0, 10);
        // è¿›å…¥é¦–é¡µåè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡è®¡ç®—
        calculateDateDifference();
    });

    function toggleVisibility1() {
        document.getElementById("myDiv").style.display = "block";
    }
    function toggleVisibility2() {
        // æ·»åŠ æŠ–åŠ¨æ•ˆæœ
        const body = document.body;
        
        // å¢å¼ºæŠ–åŠ¨æ•ˆæœ
        body.style.animation = "shake 0.4s ease-in-out 5";
        
        // æŠ–åŠ¨ç»“æŸåæ˜¾ç¤ºç“œå¨ƒå­æç¤º
        setTimeout(() => {
            // åˆ›å»ºæç¤ºå…ƒç´ 
            const alertDiv = document.createElement('div');
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '50%';
            alertDiv.style.left = '50%';
            alertDiv.style.transform = 'translate(-50%, -50%)';
            alertDiv.style.zIndex = '99999';
            alertDiv.style.fontSize = '60px';
            alertDiv.style.fontWeight = 'bold';
            alertDiv.style.color = '#ff0000';
            alertDiv.style.backgroundColor = 'rgba(255, 255, 255, 0.95)';
            alertDiv.style.padding = '40px';
            alertDiv.style.borderRadius = '20px';
            alertDiv.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.3)';
            alertDiv.style.textAlign = 'center';
            alertDiv.style.animation = 'fadeInOut 3s ease-in-out forwards';
            alertDiv.textContent = 'ç“œå¨ƒå­ ğŸ˜¡';
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(alertDiv);
            
            // 3ç§’åç§»é™¤æç¤º
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
                // æ¢å¤é¡µé¢æ­£å¸¸çŠ¶æ€
                body.style.animation = '';
            }, 3000);
        }, 2000);
    }

    function cleanDate() {
        document.getElementById("result1").innerHTML = "";
        document.getElementById("result2").innerHTML = "";
    }

    // è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨ï¼ˆå¼¹çª—ï¼‰
    let dpYear, dpMonth, dpInit = false;
    function ensureDatePicker() {
        if (dpInit) return;
        // æ³¨å…¥æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.35); display: none; align-items: center; justify-content: center; z-index: 9999; }
        .modal { width: 340px; background: #ffffff; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); padding: 12px; }
        .date-picker-header { display:flex; justify-content:space-between; align-items:center; font-weight:600; color:#2c3e50; margin-bottom:8px; }
        .dp-weekday { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; margin: 6px 0; font-size:12px; color:#6c757d; }
        .dp-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; }
        .dp-cell { background:white; border-radius:8px; padding:8px; box-shadow:0 1px 3px rgba(0,0,0,0.08); text-align:center; cursor:pointer; }
        .dp-cell:hover { background:#f0f7ff; }
        .dp-day { font-weight:700; color:#2c3e50; }
        .dp-actions { display:flex; justify-content:flex-end; margin-top:8px; }
        .dp-today { border:1px solid #4ba2f9; background:linear-gradient(90deg,#e3f2fd,#f0f8ff); }
        `;
        document.head.appendChild(style);
        // æ³¨å…¥å¼¹çª—ç»“æ„
        const overlay = document.createElement('div');
        overlay.id = 'datePickerModal';
        overlay.className = 'modal-overlay';
        overlay.innerHTML = `
          <div class="modal">
            <div class="date-picker-header">
              <button class="month-btn" onclick="dpPrev()">â†</button>
              <div id="dpHeader"></div>
              <button class="month-btn" onclick="dpNext()">â†’</button>
            </div>
            <div class="dp-weekday" id="dpWeekHeader"></div>
            <div class="dp-grid" id="dpGrid"></div>
            <div class="dp-actions">
              <button class="month-btn" onclick="closeDatePicker()">å…³é—­</button>
            </div>
          </div>`;
        document.body.appendChild(overlay);
        dpInit = true;
    }
    function renderDpHeader() {
        document.getElementById('dpHeader').textContent = `${dpYear}å¹´${('0' + dpMonth).slice(-2)}æœˆ`;
    }
    function renderDpWeekdays() {
        const names = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
        const header = document.getElementById('dpWeekHeader');
        header.innerHTML = '';
        names.forEach(n => {
            const span = document.createElement('div');
            span.className = 'weekday-cell';
            span.textContent = `å‘¨${n}`;
            header.appendChild(span);
        });
    }
    function renderDpGrid() {
        const grid = document.getElementById('dpGrid');
        grid.innerHTML = '';
        const y = dpYear;
        const m = dpMonth - 1;
        const firstDay = new Date(y, m, 1);
        const daysInMonth = new Date(y, m + 1, 0).getDate();
        const offset = firstDay.getDay();
        for (let i = 0; i < offset; i++) {
            const empty = document.createElement('div');
            empty.className = 'dp-cell';
            empty.style.visibility = 'hidden';
            grid.appendChild(empty);
        }
        const today = new Date();
        const isSameMonth = (today.getFullYear() === y && (today.getMonth()+1) === dpMonth);
        for (let day = 1; day <= daysInMonth; day++) {
            const cell = document.createElement('div');
            cell.className = 'dp-cell';
            const dayEl = document.createElement('div');
            dayEl.className = 'dp-day';
            dayEl.textContent = day;
            cell.appendChild(dayEl);
            if (isSameMonth && today.getDate() === day) {
                cell.classList.add('dp-today');
            }
            cell.addEventListener('click', function(){
                const v = `${y}-${('0'+(m+1)).slice(-2)}-${('0'+day).slice(-2)}`;
                const input = document.getElementById('endDate');
                input.value = v;
                cleanDate();
                closeDatePicker();
            });
            grid.appendChild(cell);
        }
    }
    function renderDatePicker() {
        renderDpHeader();
        renderDpWeekdays();
        renderDpGrid();
    }
    function openDatePicker() {
        ensureDatePicker();
        const input = document.getElementById('endDate');
        let base = new Date();
        if (input.value) {
            const parts = input.value.split('-');
            if (parts.length === 3) base = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        }
        dpYear = base.getFullYear();
        dpMonth = base.getMonth() + 1;
        document.getElementById('datePickerModal').style.display = 'flex';
        renderDatePicker();
    }
    function closeDatePicker() {
        const overlay = document.getElementById('datePickerModal');
        if (overlay) overlay.style.display = 'none';
    }
    function dpPrev() { if (dpMonth === 1) { dpMonth = 12; dpYear--; } else { dpMonth--; } renderDatePicker(); }
    function dpNext() { if (dpMonth === 12) { dpMonth = 1; dpYear++; } else { dpMonth++; } renderDatePicker(); }

    // indexé¡µï¼šè¿”å›å³å…³é—­/é€€å‡ºï¼ˆé¿å…è¿”å›å¤šæ¬¡ï¼‰
    (function enableBackToClose(){
        try {
            if (window.__backToCloseEnabled) return;
            window.__backToCloseEnabled = true;
            history.pushState({backClose:true}, document.title, location.href);
            window.addEventListener('popstate', function(){
                let closed = false;
                try {
                    window.open('', '_self');
                    window.close();
                    closed = true;
                } catch(e) {}
                if (!closed) {
                    location.replace('about:blank');
                }
            });
        } catch(e) {}
    })();

    function calculateDateDifference() {
        var startDate = new Date("2023-07-02");
        var endDate = new Date(document.getElementById("endDate").value);

        var millisecondsPerDay = 24 * 60 * 60 * 1000;
        var daysDifference = Math.round(Math.abs((endDate - startDate) / millisecondsPerDay));

        var day = "å¼‚å¸¸";
        var dayId = daysDifference % 5;
        switch (dayId) {
            case 0:
                day = "ç¬¬1ä¸ªå¤œç­";
                break;
            case 1:
                day = "ç¬¬2ä¸ªå¤œç­";
                break;
            case 2:
                day = "ç¬¬1ä¸ªç™½ç­";
                break;
            case 3:
                day = "ç¬¬2ä¸ªç™½ç­";
                break;
            case 4:
                day = "ä¼‘æ¯å¤©";
                break;
        }
        document.getElementById("result1").style.color = '#FF0000';
        document.getElementById("result1").innerHTML = "è¿™å¤©æ˜¯ " + day;

        // å°†å¤©æ•°æ¢ç®—ä¸º å¹´/æœˆ/æ—¥ çš„äººç±»å¯è¯»æ ¼å¼ï¼ˆæŒ‰æ—¥å†å·®ï¼‰
        var a = new Date(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());
        var b = new Date(endDate.getFullYear(), endDate.getMonth(), endDate.getDate());
        if (a > b) { var tmp = a; a = b; b = tmp; }
        var y = b.getFullYear() - a.getFullYear();
        var m = b.getMonth() - a.getMonth();
        var d = b.getDate() - a.getDate();
        if (d < 0) {
            m -= 1;
            var daysInPrevMonth = new Date(b.getFullYear(), b.getMonth(), 0).getDate();
            d += daysInPrevMonth;
        }
        if (m < 0) { y -= 1; m += 12; }
        var parts = [];
        if (y) parts.push(y + "å¹´");
        if (m) parts.push(m + "ä¸ªæœˆ");
        if (d || parts.length === 0) parts.push(d + "å¤©");
        var ymdText = parts.join("");

        document.getElementById("result2").innerHTML = "å·²ç»ä¸Šäº† " + daysDifference + " å¤©ç­ï¼ˆ" + ymdText + "ï¼‰";
    }

    // è®¾ç½®ç»“æŸæ—¥æœŸçš„é»˜è®¤å€¼ä¸ºå½“å‰æ—¥æœŸ
    var currentDate = new Date();
    var endDateInput = document.getElementById("endDate");
    endDateInput.value = getCurrentTime().slice(0, 10);
    // è·å–å½“å‰æ—¶é—´ISOæ ¼å¼å­—ç¬¦ä¸²
    function getCurrentTime() {
        let datetime = new Date();
        let timezoneOffset = datetime.getTimezoneOffset() * 60000; // è·å–å½“å‰æ—¶åŒºä¸UTCçš„æ—¶é—´å·®ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰
        let localDatetime = new Date(datetime - timezoneOffset); // è°ƒæ•´æ—¶é—´ï¼Œå¾—åˆ°å½“å‰æ—¶åŒºæ—¶é—´
        let isoString = localDatetime.toISOString();
        return isoString;
    }

</script>
<script>
</script>

</html>
